{"version":3,"file":"main.cjs","sources":["../lib/doctype.js","../lib/render.js","../lib/use.js","../main.js"],"sourcesContent":["const DOCTYPE = '<!doctype html>'\n\n/**\n * Add doctype to HTML files.\n *\n * @param {string} content\n * @param {string} outputPath\n * @returns {string}\n */\nexport function doctype(content, outputPath) {\n\tconst isHTMLFile = outputPath.endsWith('.html')\n\tconst hasDoctype = content.trim().toLowerCase().startsWith(DOCTYPE)\n\n\tif (isHTMLFile && !hasDoctype) {\n\t\treturn `${DOCTYPE}${content}`\n\t}\n\n\treturn content\n}\n","import path from 'node:path'\nimport pluginVue from '@vitejs/plugin-vue'\nimport { requireFromString } from 'module-from-string'\nimport { rollup } from 'rollup'\nimport pluginCSS from 'rollup-plugin-css-only'\nimport { createSSRApp } from 'vue'\nimport { renderToString } from 'vue/server-renderer'\n\nconst CWD = process.cwd()\n\n/**\n * Compile and render Vue component.\n *\n * @param {Object} options\n * @param {string} options.inputPath\n * @param {Object<string, any>} options.data\n * @param {Object<string, function>} options.methods\n * @param {Object} options.rollupOptions\n */\nexport async function render({ inputPath, data, methods, rollupOptions }) {\n\tconst filename = path.join(CWD, inputPath)\n\tlet css = ''\n\n\tconst rollupConfig = {\n\t\tinput: filename,\n\t\tplugins: [\n\t\t\tpluginVue({\n\t\t\t\tssr: true\n\t\t\t}),\n\t\t\tpluginCSS({\n\t\t\t\toutput: styles => {\n\t\t\t\t\tcss = styles\n\t\t\t\t}\n\t\t\t})\n\t\t],\n\t\texternal: ['@mvsde/eleventy-plugin-vue', 'vue']\n\t}\n\n\tfor (let key in rollupOptions) {\n\t\tif (key === 'external' || key === 'plugins') {\n\t\t\t// merge the Array\n\t\t\trollupConfig[key] = rollupConfig[key].concat(rollupOptions[key])\n\t\t} else {\n\t\t\trollupConfig[key] = rollupOptions[key]\n\t\t}\n\t}\n\n\tconst bundle = await rollup(rollupConfig)\n\n\tconst template = await bundle.generate({\n\t\tformat: 'cjs',\n\t\texports: 'default'\n\t})\n\n\tconst component = requireFromString(template.output[0].code, {\n\t\tfilename: path.basename(filename),\n\t\tdirname: path.dirname(filename)\n\t})\n\n\tconst app = createSSRApp(component)\n\n\tapp.config.globalProperties.$data = data\n\tapp.config.globalProperties.$methods = methods\n\tapp.config.globalProperties.$css = css\n\n\treturn renderToString(app)\n}\n","import { getCurrentInstance } from 'vue'\n\n/**\n * Workaround for global data and methods in `<script setup>`.\n * Eleventy injects the data into the template. To use it from the script,\n * we need to extract the data from the app instance.\n *\n * Source: https://forum.vuejs.org/t/how-to-use-globalproperties-in-vue-3-setup-method/108387/4\n */\n\n/**\n * @returns {Object}\n */\nexport function useData() {\n\tconst app = getCurrentInstance()\n\treturn app?.appContext.config.globalProperties.$data ?? {}\n}\n\n/**\n * @returns {Object<string,function>}\n */\nexport function useMethods() {\n\tconst app = getCurrentInstance()\n\treturn app?.appContext.config.globalProperties.$methods ?? {}\n}\n\n/**\n * @returns {string|null}\n */\nexport function useCSS() {\n\tconst app = getCurrentInstance()\n\treturn app?.appContext.config.globalProperties.$css\n}\n","import { doctype } from './lib/doctype.js'\nimport { render } from './lib/render.js'\n\n/**\n * @param {import('@11ty/eleventy/src/UserConfig')} eleventyConfig\n */\nexport function pluginVue(eleventyConfig, options) {\n\televentyConfig.addTemplateFormats('vue')\n\n\televentyConfig.addExtension('vue', {\n\t\tcompile(_, inputPath) {\n\t\t\treturn data =>\n\t\t\t\trender({\n\t\t\t\t\tinputPath,\n\t\t\t\t\tdata,\n\t\t\t\t\tmethods: this.config.javascriptFunctions,\n\t\t\t\t\trollupOptions: options.rollupOptions\n\t\t\t\t})\n\t\t},\n\t\tread: false\n\t})\n\n\televentyConfig.addTransform('doctype', doctype)\n}\n\nexport * from './lib/use.js'\n"],"names":["pluginVue","rollup","requireFromString","createSSRApp","renderToString","getCurrentInstance"],"mappings":"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"}